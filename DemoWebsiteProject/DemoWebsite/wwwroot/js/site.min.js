$(document).ready(function () {
    $('#employees-table').DataTable({
        order: [[1, 'asc']]
    });

    var table = $('#files-table').DataTable({
        columnDefs: [{
            orderable: false,
            className: 'select-checkbox',
            targets: 0
        },
        {
            visible: false,
            targets: 1
        }],
        select: {
            style: 'multi',
            selector: 'td:first-child'
        },
        order: [[1, 'asc']],
        searching: false,
        paging: false,
        info: false
    });

    table
        .on('select', function (e, dt, type, indexes) {
            if (type === 'row') {
                var id = table.row(indexes).data()[1];
                AddItem(id);
            }
        })
        .on('deselect', function (e, dt, type, indexes) {
            if (type === 'row') {
                var id = table.row(indexes).data()[1];
                RemoveItem(id);
            }
        });
});

var selectedFiles = [];

function AddItem(id) {
    for (var i = 0; i < selectedFiles.length; i++) {
        if (selectedFiles[i] == id) {
            return;
        }
    }

    selectedFiles[selectedFiles.length] = id;
    UpdateDeletedBtn();
}

function RemoveItem(id) {
    for (var i = 0; i < selectedFiles.length; i++) {
        if (selectedFiles[i] == id) {
            selectedFiles.splice(i, 1);
        }
    }

    UpdateDeletedBtn();
}

function UpdateDeletedBtn() {
    if (selectedFiles.length == 0) {
        $("#delete-selected-btn").prop('disabled', true);
    }
    else {
        $("#delete-selected-btn").prop('disabled', false);
    }
}

var fileEditorEnabled = false;

function SwitchFileEditor() {
    if (fileEditorEnabled == false) {
        $(".file-row-a").prop('style', 'display: none');
        $(".file-row-input").removeProp('style');
        $("#edit-names").html('Cancel edit');
        $("#edit-names").prop('class', 'btn btn-warning');
        $("#save-names").removeProp('style');
        $("#reset-names").removeProp('style');
        fileEditorEnabled = true;
    }
    else {
        ResetFileNames();
        $(".file-row-a").removeProp('style');
        $(".file-row-input").prop('style', 'display: none');
        $("#edit-names").html('Edit names');
        $("#edit-names").prop('class', 'btn btn-primary');
        $("#save-names").prop('style', 'display: none');
        $("#reset-names").prop('style', 'display: none');
        fileEditorEnabled = false;
    }
}

function ResetFileNames() {
    for (var i = 0; i < updatedFiles.length; i++) {        
        var input = updatedFiles[i][2];
        $(input).val($(input).parent().children(".file-row-a").text());
        $(input).removeProp('style');
    } 

    updatedFiles.splice(0, updatedFiles.length);
    UpdateSaveBtn();
}

var updatedFiles = [];

function AddFileToUpdatedList(id, filename, input) {   
    if (filename != $(input).parent().children(".file-row-a").text()) {
        $(input).prop('style', 'background-color: lightgreen');
    }
    else {
        $(input).removeProp('style');

        for (var i = 0; i < updatedFiles.length; i++) {
            if (updatedFiles[i][0] == id) {
                updatedFiles.splice(i, 1);
                UpdateSaveBtn();
                return;
            }
        }
    }

    for (var i = 0; i < updatedFiles.length; i++) {
        if (updatedFiles[i][0] == id) {
            updatedFiles[i][1] = filename;
            return;
        }
    }    

    updatedFiles.push([id, filename, input]);
    UpdateSaveBtn();
}

function UpdateFileNames() {
    for (var i = 0; i < updatedFiles.length; i++) {
        var input = updatedFiles[i][2];
        $(input).parent().children(".file-row-a").text(updatedFiles[i][1]);
    }

    updatedFiles.splice(0, updatedFiles.length);
    UpdateSaveBtn();
    SwitchFileEditor();
}

function UpdateSaveBtn() {
    if (updatedFiles.length == 0) {
        $("#save-names").prop('disabled', true);
        $("#reset-names").prop('disabled', true);
    }
    else {
        $("#save-names").prop('disabled', false);
        $("#reset-names").prop('disabled', false);
    }
}

$(document).ready(function () {
    $('li.active').removeClass('active');
    $('a[href="' + location.pathname + '"]').closest('li').addClass('active');
});